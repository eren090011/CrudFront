@page "/EditarEmpleado/{EmpleadoId}"

@using CurrieTechnologies.Razor.SweetAlert2
@using FrontCrudEmpleados.Entities.DTOs
@inject SweetAlertService swal
@inject NavigationManager navigationManager
@inject IRepositorio repositorio

<h3>Editar Empleado</h3>
<h2>ID: @EmpleadoId</h2>
<FormularioEmpleados Empleado="Empleado" OnValidSubmit="Editar" />
@code

{
    [Parameter] public String EmpleadoId { get; set; }
    private Empleado Empleado = new Empleado();


    protected async override Task OnInitializedAsync()
    {
        var respuestaHTTP = await repositorio.GetById<EmpleadoDTO>($"api/Empleados/{EmpleadoId}");
        EmpleadoDTO empleadoDTO = respuestaHTTP.Response!;
        if(empleadoDTO is not null)
        {
            string nombreCompleto = empleadoDTO.NombreCompleto;
            string[] partes = nombreCompleto.Split(' ');
            string Nombre = partes[0];
            string Apellido = partes[1];
            Empleado.Id = empleadoDTO.Id;
            Empleado.Nombre = Nombre;
            Empleado.Apellido = Apellido;
            Empleado.Pais = empleadoDTO.Pais;
            Empleado.Cargo = empleadoDTO.Cargo;
            Empleado.Edad = empleadoDTO.Edad;
            Empleado.UrlFoto = empleadoDTO.UrlFoto;
            Empleado.Linea1 = empleadoDTO.Linea1;
            Empleado.Linea2 = empleadoDTO.Linea2;
            Empleado.Ciudad = empleadoDTO.Ciudad;
            Empleado.Departamento = empleadoDTO.Departamento;
            Empleado.Active = empleadoDTO.Active;
        }
        



    }


    async Task Editar()
    {
        var httpResponse = await repositorio.Put<Empleado>($"api/Empleados/{EmpleadoId}", Empleado);

        Console.WriteLine(httpResponse.Response);

        if (httpResponse.Error)
        {
            var mensajeError = await httpResponse.ObtenerMensajeError();
            await swal.FireAsync("Error", mensajeError, SweetAlertIcon.Error);
        }
        else
        {
            // aca se navega inicio otra vez

            navigationManager
                .NavigateTo($"/");
        }
    }
} 